"use client";

import { toFarsiNumber } from "@/helper/helper";
import useModelStore from "@/store/useModelStore";
import React, { useState } from "react";
import DuplicateIcon from "../icons/DuplicateIcon";

const Settings = () => {
  const rotationOptions = [15, 30, 45, 90, 180];
  const gridSnapSize = [0.1, 0.5, 1];

  const [openSettings, setOpenSettings] = useState(false);
  const modelOptions = useModelStore((s) => s.modelOptions);
  const setModelOptions = useModelStore((s) => s.setModelOptions);
  const modelsRef = useModelStore((s) => s.modelsRef);
  const selectedModels = useModelStore((s) => s.selectedModels);
  const selectedModelId = useModelStore((s) => s.selectedModelId);
  const setSelectedModelId = useModelStore((s) => s.setSelectedModelId);

  const changeRotationDegHandler = (angle) => {
    setModelOptions({ rotationDeg: angle });
  };

  const changeSnapSizeHandler = (size) => {
    setModelOptions({ snapSize: size });
  };

  const duplicateModelHandler = () => {
    const currentModel = selectedModels.find((m) => m.id === selectedModelId);
    if (!currentModel) {
      return;
    }

    const object = modelsRef.current; // گرفتن مدل از scene
    if (!object) {
      return;
    }

    const newId = Date.now();

    const newModel = {
      ...currentModel,
      id: newId,
      position: [
        object.position.x, // استفاده از موقعیت فعلی در صحنه
        object.position.y,
        object.position.z + 1,
      ],
      rotation: [
        object.rotation.x, // استفاده از چرخش فعلی در صحنه
        object.rotation.y,
        object.rotation.z,
      ],
    };

    useModelStore.setState((state) => ({
      selectedModels: [...state.selectedModels, newModel],
    }));

    setSelectedModelId(newId);
  };

  return (
    <div
      className={`absolute w-60 h-auto bg-white rounded-r-2xl shadow-lg shadow-gray-100 z-50 top-2/4 -translate-y-2/4 ${
        openSettings ? "left-0" : "-left-60"
      } transition-all duration-300`}
    >
      <div className="w-full h-full flex flex-col gap-4 p-4 relative">
        <button
          onClick={() => setOpenSettings(!openSettings)}
          className="size-10 bg-white rounded-r-xl flex justify-center items-center text-gray-800 hover:text-primaryThemeColor transition-all duration-300 absolute top-2/4 -translate-y-2/4 -right-10"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width={18}
            height={18}
            viewBox="0 0 16 16"
          >
            <path
              d="M7.818848 0.848928C7.6345600000000005 0.8692000000000001 7.468128 0.919072 7.288 1.008C7.071904000000001 1.114704 6.895840000000001 1.257504 6.742048 1.450816C6.5653440000000005 1.6729120000000002 6.271952000000001 1.959616 6.111712000000001 2.066752C5.849088 2.242384 5.492848 2.3940639999999997 5.2 2.454944C4.955648 2.5057440000000004 4.695968 2.51736 4.426608 2.489536C4.290688 2.475488 4.1220479999999995 2.464 4.05184 2.464C3.2361280000000003 2.464 2.52392 3.131344 2.4691680000000003 3.9469600000000002C2.4629119999999998 4.04024 2.469792 4.207904000000001 2.488016 4.405984C2.5126560000000002 4.673904 2.5140000000000002 4.745312 2.49744 4.910688C2.454016 5.3442240000000005 2.308368 5.750416 2.066752 6.111712000000001C1.959616 6.271952000000001 1.6729120000000002 6.5653440000000005 1.450816 6.742048C1.257504 6.895840000000001 1.114704 7.071904000000001 1.008 7.288C0.8712000000000001 7.565055999999999 0.8174880000000001 7.857056 0.848336 8.156C0.870272 8.368704 0.914448 8.522528000000001 1.008 8.712C1.114704 8.928096 1.257504 9.10416 1.450816 9.257952C1.6729120000000002 9.434656 1.959616 9.728048000000001 2.066752 9.888288000000001C2.308368 10.249584 2.454016 10.655776 2.49744 11.089312C2.5140000000000002 11.254688 2.5126560000000002 11.326096 2.488016 11.594016C2.469792 11.792095999999999 2.4629119999999998 11.959760000000001 2.4691680000000003 12.053040000000001C2.52392 12.868656000000001 3.2361280000000003 13.536 4.05184 13.536C4.1220479999999995 13.536 4.290688 13.524512000000001 4.426608 13.510464C4.695968 13.48264 4.955648 13.494256 5.2 13.545056C5.492848 13.605936 5.849088 13.757616 6.111712000000001 13.933248C6.271952000000001 14.040384 6.5653440000000005 14.327088 6.742048 14.549184C6.895840000000001 14.742496 7.071904000000001 14.885296 7.288 14.992C7.477472 15.085552 7.631296000000001 15.129728 7.844 15.151664C8.142944 15.182512000000001 8.434944 15.1288 8.712 14.992C8.928096 14.885296 9.10416 14.742496 9.257952 14.549184C9.434656 14.327088 9.728048000000001 14.040384 9.888288000000001 13.933248C10.150912 13.757616 10.507152 13.605936 10.8 13.545056C11.044352000000002 13.494256 11.304032 13.48264 11.573392 13.510464C11.709312 13.524512000000001 11.877951999999999 13.536 11.94816 13.536C12.763872 13.536 13.47608 12.868656000000001 13.530832 12.053040000000001C13.537088 11.959760000000001 13.530208 11.792095999999999 13.511984 11.594016C13.487344 11.326096 13.486 11.254688 13.502559999999999 11.089312C13.545984 10.655776 13.691632 10.249584 13.933248 9.888288000000001C14.040384 9.728048000000001 14.327088 9.434656 14.549184 9.257952C14.742496 9.10416 14.885296 8.928096 14.992 8.712C15.1288 8.434944 15.182512000000001 8.142944 15.151664 7.844C15.129728 7.631296000000001 15.085552 7.477472 14.992 7.288C14.885296 7.071904000000001 14.742496 6.895840000000001 14.549184 6.742048C14.327088 6.5653440000000005 14.040384 6.271952000000001 13.933248 6.111712000000001C13.693232 5.752800000000001 13.547488 5.34832 13.503120000000001 4.918064C13.487408 4.7656 13.48792 4.684768 13.505872 4.489104C13.536752 4.152688 13.533184 3.845056 13.496784 3.704C13.359744000000001 3.1729760000000002 12.996448000000001 2.760416 12.495472 2.566944C12.22688 2.463216 12.006896000000001 2.444736 11.573392 2.489536C11.081376 2.540368 10.626959999999999 2.45784 10.184000000000001 2.2372C9.84376 2.0677440000000002 9.579392 1.847088 9.30088 1.5001120000000001C9.133023999999999 1.2910080000000002 9.00032 1.171184 8.816 1.0622880000000001C8.521056000000002 0.888064 8.161888 0.811216 7.818848 0.848928M7.881424 2.01696C7.774416 2.043664 7.71776 2.0917600000000003 7.5466239999999996 2.3011999999999997C7.180464 2.749328 6.79304 3.0580160000000003 6.296 3.297696C5.9307039999999995 3.47384 5.564256 3.586688 5.184 3.6401280000000003C4.974144 3.669632 4.492287999999999 3.674576 4.304 3.6491840000000004C4.238 3.640272 4.133216 3.632768 4.071136 3.632496C3.9246239999999997 3.6318560000000004 3.8155520000000003 3.683136 3.728064 3.7938240000000003C3.63832 3.90736 3.62544 3.960336 3.639328 4.1590240000000005C3.645824 4.251968 3.656032 4.4 3.6620320000000004 4.488C3.6965120000000002 4.993856 3.6072800000000003 5.552448 3.4148 6.035632C3.17264 6.6435200000000005 2.8199520000000002 7.12144 2.2968 7.550624C2.0436 7.758336000000001 2.008 7.813728 2.008 8C2.008 8.186272 2.0436 8.241664 2.2968 8.449376C2.8199520000000002 8.87856 3.17264 9.35648 3.4148 9.964368C3.6072800000000003 10.447552 3.6965120000000002 11.006144 3.6620320000000004 11.512C3.656032 11.6 3.64576 11.749152 3.639184 11.843456C3.624736 12.050896000000002 3.645488 12.121568 3.753552 12.232736000000001C3.8822080000000003 12.365120000000001 4.004128000000001 12.39128 4.304 12.350816000000002C4.493424 12.325263999999999 4.974288 12.330352000000001 5.184 12.360128000000001C5.566928 12.414512 5.95016 12.532304 6.2998400000000006 12.703088C6.800192 12.947472 7.179376 13.250672000000002 7.550624 13.7032C7.758464 13.95656 7.81304 13.991584000000001 8 13.991584000000001C8.186960000000001 13.991584000000001 8.241536 13.95656 8.449376 13.7032C8.996464 13.03632 9.680128000000002 12.607824 10.502368 12.416432C10.837056 12.338528 11.38264 12.308544 11.696 12.350816000000002C11.995872 12.39128 12.117792 12.365120000000001 12.246448000000001 12.232736000000001C12.354512000000001 12.121568 12.375264 12.050896000000002 12.360816000000002 11.843456C12.35424 11.749152 12.343968 11.6 12.337968000000002 11.512C12.324272 11.31112 12.342304 10.917072000000001 12.373840000000001 10.728C12.526335999999999 9.813872 12.972848 9.048544 13.7032 8.449376C13.95656 8.241536 13.991584000000001 8.186960000000001 13.991584000000001 8C13.991584000000001 7.81304 13.95656 7.758464 13.7032 7.550624C13.031232000000001 6.99936 12.616336 6.335712000000001 12.415808000000002 5.491376000000001C12.340864 5.1758239999999995 12.30848 4.5808 12.350736000000001 4.296C12.39216 4.01696 12.364863999999999 3.8848640000000003 12.24 3.7600000000000002C12.114544 3.634544 11.991024 3.609376 11.696 3.6491840000000004C11.506575999999999 3.674736 11.025712 3.669648 10.816 3.639872C10.433072000000001 3.585488 10.04984 3.467696 9.70016 3.296912C9.199808 3.0525279999999997 8.820624 2.749328 8.449376 2.2968C8.324992 2.145168 8.26016 2.0797280000000002 8.207696 2.052848C8.12504 2.0104800000000003 7.973968 1.993872 7.881424 2.01696M7.744 4.729424C7.267424 4.770448 7.020608 4.81592 6.706848 4.920464C5.5874880000000005 5.293488 4.895823999999999 6.203648 4.7496160000000005 7.496C4.723984000000001 7.7224319999999995 4.723984000000001 8.277567999999999 4.7496160000000005 8.504C4.895823999999999 9.796352 5.5874880000000005 10.706512 6.706848 11.079536000000001C7.114832000000001 11.215487999999999 7.4809280000000005 11.269168 8 11.269168C8.1892 11.269168 8.4196 11.260432000000002 8.512 11.24976C10.088352 11.067552 11.069184 10.086656000000001 11.249584 8.512C11.274384 8.295584000000002 11.274384 7.704416 11.249584 7.488C11.069984 5.920256 10.074959999999999 4.9212 8.5256 4.752975999999999C8.356272 4.734592 7.858288 4.719584 7.744 4.729424M7.656000000000001 5.905408C6.790432 5.9943040000000005 6.249632 6.3890720000000005 6.016624 7.1020959999999995C5.8468480000000005 7.621600000000001 5.847536 8.378736000000002 6.018256 8.903568C6.1047839999999995 9.169584 6.224512 9.375296 6.399024000000001 9.557792C6.695264 9.867584 7.0989759999999995 10.037312 7.677696 10.095376C8.212031999999999 10.148976000000001 8.783824000000001 10.064272 9.16 9.875776C9.325136 9.793023999999999 9.45008 9.70336 9.57672 9.57672C9.888128 9.265328 10.053536000000001 8.845824 10.099088 8.252C10.12992 7.849952 10.082 7.394032 9.975888000000001 7.08C9.831392 6.652352 9.551343999999999 6.321216000000001 9.17272 6.13032C8.787120000000002 5.935904000000001 8.202768 5.849247999999999 7.656000000000001 5.905408"
              stroke="none"
              fill="currentColor"
              fillRule="evenodd"
              strokeWidth={0.016}
            />
          </svg>
        </button>

        <div className="flex items-center gap-2">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width={18}
            height={18}
            viewBox="0 0 16 16"
          >
            <path
              d="M7.818848 0.848928C7.6345600000000005 0.8692000000000001 7.468128 0.919072 7.288 1.008C7.071904000000001 1.114704 6.895840000000001 1.257504 6.742048 1.450816C6.5653440000000005 1.6729120000000002 6.271952000000001 1.959616 6.111712000000001 2.066752C5.849088 2.242384 5.492848 2.3940639999999997 5.2 2.454944C4.955648 2.5057440000000004 4.695968 2.51736 4.426608 2.489536C4.290688 2.475488 4.1220479999999995 2.464 4.05184 2.464C3.2361280000000003 2.464 2.52392 3.131344 2.4691680000000003 3.9469600000000002C2.4629119999999998 4.04024 2.469792 4.207904000000001 2.488016 4.405984C2.5126560000000002 4.673904 2.5140000000000002 4.745312 2.49744 4.910688C2.454016 5.3442240000000005 2.308368 5.750416 2.066752 6.111712000000001C1.959616 6.271952000000001 1.6729120000000002 6.5653440000000005 1.450816 6.742048C1.257504 6.895840000000001 1.114704 7.071904000000001 1.008 7.288C0.8712000000000001 7.565055999999999 0.8174880000000001 7.857056 0.848336 8.156C0.870272 8.368704 0.914448 8.522528000000001 1.008 8.712C1.114704 8.928096 1.257504 9.10416 1.450816 9.257952C1.6729120000000002 9.434656 1.959616 9.728048000000001 2.066752 9.888288000000001C2.308368 10.249584 2.454016 10.655776 2.49744 11.089312C2.5140000000000002 11.254688 2.5126560000000002 11.326096 2.488016 11.594016C2.469792 11.792095999999999 2.4629119999999998 11.959760000000001 2.4691680000000003 12.053040000000001C2.52392 12.868656000000001 3.2361280000000003 13.536 4.05184 13.536C4.1220479999999995 13.536 4.290688 13.524512000000001 4.426608 13.510464C4.695968 13.48264 4.955648 13.494256 5.2 13.545056C5.492848 13.605936 5.849088 13.757616 6.111712000000001 13.933248C6.271952000000001 14.040384 6.5653440000000005 14.327088 6.742048 14.549184C6.895840000000001 14.742496 7.071904000000001 14.885296 7.288 14.992C7.477472 15.085552 7.631296000000001 15.129728 7.844 15.151664C8.142944 15.182512000000001 8.434944 15.1288 8.712 14.992C8.928096 14.885296 9.10416 14.742496 9.257952 14.549184C9.434656 14.327088 9.728048000000001 14.040384 9.888288000000001 13.933248C10.150912 13.757616 10.507152 13.605936 10.8 13.545056C11.044352000000002 13.494256 11.304032 13.48264 11.573392 13.510464C11.709312 13.524512000000001 11.877951999999999 13.536 11.94816 13.536C12.763872 13.536 13.47608 12.868656000000001 13.530832 12.053040000000001C13.537088 11.959760000000001 13.530208 11.792095999999999 13.511984 11.594016C13.487344 11.326096 13.486 11.254688 13.502559999999999 11.089312C13.545984 10.655776 13.691632 10.249584 13.933248 9.888288000000001C14.040384 9.728048000000001 14.327088 9.434656 14.549184 9.257952C14.742496 9.10416 14.885296 8.928096 14.992 8.712C15.1288 8.434944 15.182512000000001 8.142944 15.151664 7.844C15.129728 7.631296000000001 15.085552 7.477472 14.992 7.288C14.885296 7.071904000000001 14.742496 6.895840000000001 14.549184 6.742048C14.327088 6.5653440000000005 14.040384 6.271952000000001 13.933248 6.111712000000001C13.693232 5.752800000000001 13.547488 5.34832 13.503120000000001 4.918064C13.487408 4.7656 13.48792 4.684768 13.505872 4.489104C13.536752 4.152688 13.533184 3.845056 13.496784 3.704C13.359744000000001 3.1729760000000002 12.996448000000001 2.760416 12.495472 2.566944C12.22688 2.463216 12.006896000000001 2.444736 11.573392 2.489536C11.081376 2.540368 10.626959999999999 2.45784 10.184000000000001 2.2372C9.84376 2.0677440000000002 9.579392 1.847088 9.30088 1.5001120000000001C9.133023999999999 1.2910080000000002 9.00032 1.171184 8.816 1.0622880000000001C8.521056000000002 0.888064 8.161888 0.811216 7.818848 0.848928M7.881424 2.01696C7.774416 2.043664 7.71776 2.0917600000000003 7.5466239999999996 2.3011999999999997C7.180464 2.749328 6.79304 3.0580160000000003 6.296 3.297696C5.9307039999999995 3.47384 5.564256 3.586688 5.184 3.6401280000000003C4.974144 3.669632 4.492287999999999 3.674576 4.304 3.6491840000000004C4.238 3.640272 4.133216 3.632768 4.071136 3.632496C3.9246239999999997 3.6318560000000004 3.8155520000000003 3.683136 3.728064 3.7938240000000003C3.63832 3.90736 3.62544 3.960336 3.639328 4.1590240000000005C3.645824 4.251968 3.656032 4.4 3.6620320000000004 4.488C3.6965120000000002 4.993856 3.6072800000000003 5.552448 3.4148 6.035632C3.17264 6.6435200000000005 2.8199520000000002 7.12144 2.2968 7.550624C2.0436 7.758336000000001 2.008 7.813728 2.008 8C2.008 8.186272 2.0436 8.241664 2.2968 8.449376C2.8199520000000002 8.87856 3.17264 9.35648 3.4148 9.964368C3.6072800000000003 10.447552 3.6965120000000002 11.006144 3.6620320000000004 11.512C3.656032 11.6 3.64576 11.749152 3.639184 11.843456C3.624736 12.050896000000002 3.645488 12.121568 3.753552 12.232736000000001C3.8822080000000003 12.365120000000001 4.004128000000001 12.39128 4.304 12.350816000000002C4.493424 12.325263999999999 4.974288 12.330352000000001 5.184 12.360128000000001C5.566928 12.414512 5.95016 12.532304 6.2998400000000006 12.703088C6.800192 12.947472 7.179376 13.250672000000002 7.550624 13.7032C7.758464 13.95656 7.81304 13.991584000000001 8 13.991584000000001C8.186960000000001 13.991584000000001 8.241536 13.95656 8.449376 13.7032C8.996464 13.03632 9.680128000000002 12.607824 10.502368 12.416432C10.837056 12.338528 11.38264 12.308544 11.696 12.350816000000002C11.995872 12.39128 12.117792 12.365120000000001 12.246448000000001 12.232736000000001C12.354512000000001 12.121568 12.375264 12.050896000000002 12.360816000000002 11.843456C12.35424 11.749152 12.343968 11.6 12.337968000000002 11.512C12.324272 11.31112 12.342304 10.917072000000001 12.373840000000001 10.728C12.526335999999999 9.813872 12.972848 9.048544 13.7032 8.449376C13.95656 8.241536 13.991584000000001 8.186960000000001 13.991584000000001 8C13.991584000000001 7.81304 13.95656 7.758464 13.7032 7.550624C13.031232000000001 6.99936 12.616336 6.335712000000001 12.415808000000002 5.491376000000001C12.340864 5.1758239999999995 12.30848 4.5808 12.350736000000001 4.296C12.39216 4.01696 12.364863999999999 3.8848640000000003 12.24 3.7600000000000002C12.114544 3.634544 11.991024 3.609376 11.696 3.6491840000000004C11.506575999999999 3.674736 11.025712 3.669648 10.816 3.639872C10.433072000000001 3.585488 10.04984 3.467696 9.70016 3.296912C9.199808 3.0525279999999997 8.820624 2.749328 8.449376 2.2968C8.324992 2.145168 8.26016 2.0797280000000002 8.207696 2.052848C8.12504 2.0104800000000003 7.973968 1.993872 7.881424 2.01696M7.744 4.729424C7.267424 4.770448 7.020608 4.81592 6.706848 4.920464C5.5874880000000005 5.293488 4.895823999999999 6.203648 4.7496160000000005 7.496C4.723984000000001 7.7224319999999995 4.723984000000001 8.277567999999999 4.7496160000000005 8.504C4.895823999999999 9.796352 5.5874880000000005 10.706512 6.706848 11.079536000000001C7.114832000000001 11.215487999999999 7.4809280000000005 11.269168 8 11.269168C8.1892 11.269168 8.4196 11.260432000000002 8.512 11.24976C10.088352 11.067552 11.069184 10.086656000000001 11.249584 8.512C11.274384 8.295584000000002 11.274384 7.704416 11.249584 7.488C11.069984 5.920256 10.074959999999999 4.9212 8.5256 4.752975999999999C8.356272 4.734592 7.858288 4.719584 7.744 4.729424M7.656000000000001 5.905408C6.790432 5.9943040000000005 6.249632 6.3890720000000005 6.016624 7.1020959999999995C5.8468480000000005 7.621600000000001 5.847536 8.378736000000002 6.018256 8.903568C6.1047839999999995 9.169584 6.224512 9.375296 6.399024000000001 9.557792C6.695264 9.867584 7.0989759999999995 10.037312 7.677696 10.095376C8.212031999999999 10.148976000000001 8.783824000000001 10.064272 9.16 9.875776C9.325136 9.793023999999999 9.45008 9.70336 9.57672 9.57672C9.888128 9.265328 10.053536000000001 8.845824 10.099088 8.252C10.12992 7.849952 10.082 7.394032 9.975888000000001 7.08C9.831392 6.652352 9.551343999999999 6.321216000000001 9.17272 6.13032C8.787120000000002 5.935904000000001 8.202768 5.849247999999999 7.656000000000001 5.905408"
              stroke="none"
              fill="currentColor"
              fillRule="evenodd"
              strokeWidth={0.016}
            />
          </svg>

          <h3 className="text-gray-700">تنظیمات</h3>
        </div>

        {/* snap size */}
        <div className="flex flex-col gap-4 p-2 text-xs border rounded-2xl">
          <span>اندازه جا به جایی:</span>

          <div className="flex items-center justify-between">
            {gridSnapSize.map((size) => (
              <button
                key={size}
                onClick={() => changeSnapSizeHandler(size)}
                className={`hover:text-primaryThemeColor text-xs transition-all duration-300 ${
                  modelOptions.snapSize === size ? "text-primaryThemeColor" : ""
                }`}
              >
                {toFarsiNumber(size)} سانت
              </button>
            ))}
          </div>
        </div>

        {/* rotation deg */}
        <div className="flex flex-col gap-4 p-2 text-xs border rounded-2xl">
          <span>درجه چرخش:</span>

          <div className="flex items-center justify-between">
            {rotationOptions.map((angle) => (
              <button
                key={angle}
                onClick={() => changeRotationDegHandler(angle)}
                className={`hover:text-primaryThemeColor text-xs transition-all duration-300 ${
                  modelOptions.rotationDeg === angle
                    ? "text-primaryThemeColor"
                    : ""
                }`}
              >
                {toFarsiNumber(angle)}°
              </button>
            ))}
          </div>
        </div>

        <button
          onClick={duplicateModelHandler}
          className="flex items-center text-xs gap-1 hover:text-primaryThemeColor transition-all duration-300"
        >
          <DuplicateIcon />
          <span>کپی مدل</span>
        </button>
      </div>
    </div>
  );
};

export default Settings;
